<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Contributing Guide - Wasmer Pack User Guide</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="index.html">Wasmer Pack</a></li><li class="chapter-item affix "><a href="quickstart.html">Quickstart Guide</a></li><li class="chapter-item affix "><li class="part-title">Tutorial</li><li class="chapter-item "><a href="tutorial/01-hello-world.html">Hello, World!</a></li><li class="chapter-item "><a href="tutorial/02-strings-and-lists.html">Strings and Lists</a></li><li class="chapter-item "><a href="tutorial/03-records.html">Records</a></li><li class="chapter-item "><div>Variants</div></li><li class="chapter-item "><a href="tutorial/05-resources.html">Exposing Resources</a></li><li class="chapter-item "><div>Importing Host Functions</div></li><li class="chapter-item "><div>Doing IO with WASI</div></li><li class="chapter-item "><div>Commands</div></li><li class="chapter-item "><div>Writing Guests in C</div></li><li class="chapter-item "><div>Tantivy</div></li><li class="chapter-item "><div>Integrating Tantivy with a React App</div></li><li class="chapter-item affix "><li class="part-title">Concepts</li><li class="chapter-item "><a href="concepts/wai/index.html">WebAssembly Interfaces (WAI)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="concepts/wai/types.html">Builtin Types</a></li><li class="chapter-item "><a href="concepts/wai/functions.html">Functions</a></li><li class="chapter-item "><a href="concepts/wai/records.html">Records</a></li><li class="chapter-item "><a href="concepts/wai/variants.html">Enums, Flags, Variants, and Unions</a></li><li class="chapter-item "><a href="concepts/wai/resources.html">Resources</a></li></ol></li><li class="chapter-item "><li class="part-title">How-To Guides</li><li class="chapter-item "><a href="how-to/resources-vs-records.html">Choosing Between Resources and Records</a></li><li class="chapter-item affix "><li class="part-title">For Developers</li><li class="chapter-item expanded "><a href="contributing.html" class="active">Contributing Guide</a></li><li class="chapter-item "><a href="architecture/index.html">Project Architecture</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="architecture/001-generated-package-naming.html">001 Generated Package Naming</a></li><li class="spacer"></li></ol></li><li class="chapter-item "><a href="changelog.html">Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Wasmer Pack User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/wasmerio/wasmer-pack" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/wasmerio/wasmer-pack/edit/master/doc/./contributing.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<h2 id="design-goals"><a class="header" href="#design-goals">Design Goals</a></h2>
<p>This project is developed under several assumptions,</p>
<ul>
<li>Most of the time spent using <code>wasmer-pack</code> will actually go into the IO before
and after using it rather than <em>running</em> the code generator (i.e. because you
have to download large inputs from a server), so <strong>performance is a non-goal</strong>
for this project</li>
<li>The core library should be usable by itself, but everything else can be
tailored to Wasmer's use cases</li>
</ul>
<p>As such, we prefer developer experience over flexibility and raw performance.</p>
<h3 id="goal-1-fast-compile-times"><a class="header" href="#goal-1-fast-compile-times">Goal 1: Fast Compile Times</a></h3>
<p>A clean build of the entire workspace shouldn't take any longer than 30 seconds
and all CI jobs should finish within 5 minutes.</p>
<p>This isn't actually too difficult to achieve as long as you follow some
guidelines:</p>
<ul>
<li>Don't add dependencies unless you absolutely need to</li>
<li>Trim out unnecessary features</li>
<li>Periodically use <code>cargo clean &amp;&amp; cargo build --timings</code> to see where compile
time is spent</li>
<li>Don't import crates that pull in half of crates.io</li>
</ul>
<p>The rationale behind this is simple - <a href="https://matklad.github.io/2021/09/04/fast-rust-builds.html"><strong>a short edit-compile-test cycle is a
force multiplier</strong></a>. If you have fast compile times then
developers can recompile and re-run the test suite after every change.</p>
<p>On the other hand, if CI takes 30 minutes to complete, developers will avoid
your project like the plague because getting even the most trivial changes
merged becomes a multi-hour chore.</p>
<p>To help this, we have <a href="https://github.com/Michael-F-Bryan/workflow-timer">a GitHub Action</a> which will post comments
on each PR to let you know how much your changes have affected CI times.</p>
<h3 id="goal-2-it-just-works"><a class="header" href="#goal-2-it-just-works">Goal 2: It Just Works</a></h3>
<p>Users of <code>wasmer-pack</code> should be able to compile the project from scratch and
use the generated bindings without needing to mess around with dependencies or
configuration.</p>
<p>To achieve this,</p>
<ul>
<li>Avoid dependencies that link to native libraries because they need a working C
toolchain and often require installing system libraries</li>
<li>Avoid conditional compilation (including feature flags) because they tend to
introduce edge cases that are hard to test and debug</li>
<li>Be opinionated - don't give the end user unnecessary flags or options unless
it's part of the core functionality</li>
</ul>
<h2 id="release-process"><a class="header" href="#release-process">Release Process</a></h2>
<p>This is the process if you ever need to cut a release:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Make a PR which mentions the new version in its title (e.g.
<em>&quot;Release v1.2.3&quot;</em> on a <code>releases</code> branch)</li>
<li><input disabled="" type="checkbox"/>
Update <a href="https://github.com/wasmerio/wasmer-pack/blob/master/CHANGELOG.md"><code>CHANGELOG.md</code></a> to include any user-facing changes
since the last release (the <code>[Unreleased]</code> link at the bottom is
particularly helpful here)</li>
<li><input disabled="" type="checkbox"/>
Run <a href="https://github.com/crate-ci/cargo-release"><code>cargo release</code></a>. This will...
<ul>
<li>Promote the change log's <code>[Unreleased]</code> items to a named version</li>
<li>Bump version numbers in all <code>Cargo.toml</code> files</li>
<li>Tag the commit (e.g. <code>v1.2.3</code>)</li>
<li>Publish to crates.io, and</li>
<li>Push all commits and tags to GitHub</li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
Wait for the <a href="https://github.com/wasmerio/wasmer-pack/actions/workflows/releases.yml"><em>&quot;Releases&quot;</em></a> job to pass. This will...
<ul>
<li>Publish WebAssembly binaries to WAPM</li>
<li>Use <code>cargo xtask set-generator</code> to make the WAPM backend generate
bindings with the new version of <code>wasmer-pack-cli</code></li>
</ul>
</li>
<li><input disabled="" type="checkbox"/>
Merge the <em>&quot;Release v1.2.3&quot;</em> PR into the <code>master</code> branch!</li>
</ul>
<h2 id="cargo-xtask"><a class="header" href="#cargo-xtask">Cargo xtask</a></h2>
<p>We use <a href="https://github.com/matklad/cargo-xtask">the <code>cargo xtask</code> pattern</a> for any project automation more
complex than 1 or 2 lines of shell. This means we get access to any library
on crates.io, and having everything in pure Rust means you don't need to
manually install anything or worry about OS-specific weirdness.</p>
<p>Currently, there are only a couple major tasks,</p>
<ul>
<li><code>cargo xtask set-generator</code> calls the mutation for setting a bindings
generator</li>
<li><code>cargo xtask sync-schema</code> will make sure the <code>schema.graphql</code> file is in sync
with the WAPM backend, automatically updating the file if necessary</li>
</ul>
<p>You can run <code>cargo xtask --help</code> to find out more details.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="how-to/resources-vs-records.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="architecture/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="how-to/resources-vs-records.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="architecture/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
