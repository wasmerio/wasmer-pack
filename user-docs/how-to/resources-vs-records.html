<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Choosing Between Resources and Records - Wasmer Pack User Guide</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">Wasmer Pack</a></li><li class="chapter-item affix "><a href="../quickstart.html">Quickstart Guide</a></li><li class="chapter-item affix "><li class="part-title">Tutorial</li><li class="chapter-item "><a href="../tutorial/01-hello-world.html">Hello, World!</a></li><li class="chapter-item "><a href="../tutorial/02-strings-and-lists.html">Strings and Lists</a></li><li class="chapter-item "><a href="../tutorial/03-records.html">Records</a></li><li class="chapter-item "><div>Variants</div></li><li class="chapter-item "><a href="../tutorial/05-resources.html">Exposing Resources</a></li><li class="chapter-item "><div>Importing Host Functions</div></li><li class="chapter-item "><div>Doing IO with WASI</div></li><li class="chapter-item "><div>Commands</div></li><li class="chapter-item "><div>Writing Guests in C</div></li><li class="chapter-item "><div>Tantivy</div></li><li class="chapter-item "><div>Integrating Tantivy with a React App</div></li><li class="chapter-item affix "><li class="part-title">Concepts</li><li class="chapter-item "><a href="../concepts/wai/index.html">WebAssembly Interfaces (WAI)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../concepts/wai/types.html">Builtin Types</a></li><li class="chapter-item "><a href="../concepts/wai/functions.html">Functions</a></li><li class="chapter-item "><a href="../concepts/wai/records.html">Records</a></li><li class="chapter-item "><a href="../concepts/wai/variants.html">Enums, Flags, Variants, and Unions</a></li><li class="chapter-item "><a href="../concepts/wai/resources.html">Resources</a></li></ol></li><li class="chapter-item "><li class="part-title">How-To Guides</li><li class="chapter-item expanded "><a href="../how-to/resources-vs-records.html" class="active">Choosing Between Resources and Records</a></li><li class="chapter-item affix "><li class="part-title">For Developers</li><li class="chapter-item "><a href="../contributing.html">Contributing Guide</a></li><li class="chapter-item "><a href="../architecture/index.html">Project Architecture</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../architecture/001-generated-package-naming.html">001 Generated Package Naming</a></li><li class="spacer"></li></ol></li><li class="chapter-item "><a href="../changelog.html">Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Wasmer Pack User Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/wasmerio/wasmer-pack" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/wasmerio/wasmer-pack/edit/master/doc/./how-to/resources-vs-records.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="choosing-between-resources-and-records"><a class="header" href="#choosing-between-resources-and-records">Choosing Between Resources and Records</a></h1>
<p>The difference between a <a href="../concepts/wai/resources.html">resource</a> and a
<a href="../concepts/wai/records.html">record</a> can be subtle when first starting out,
but there is a simple rule of thumb that will work 90% of the time:</p>
<blockquote>
<p>Records contain data, resources encapsulate behaviour.</p>
</blockquote>
<h2 id="typical-examples"><a class="header" href="#typical-examples">Typical Examples</a></h2>
<p>A person is a good example of a record.</p>
<pre><code>record person {
    name: string,
    age: u8,
    address: option&lt;address&gt;,
}

record address {
    number: u32,
    street: string,
    state: string,
    country: string,
    postcode: u32,
}
</code></pre>
<p>On the other hand, a database connection would be best represented using a
resource.</p>
<pre><code class="language-wai">resource database {
    static connect: func(connection_string: string) -&gt; expected&lt;database, error&gt;
    query: func(sql: string) -&gt; expected&lt;list&lt;record&gt;, error&gt;
    close: func() -&gt; expected&lt;unit, error&gt;
}
</code></pre>
<h2 id="key-considerations"><a class="header" href="#key-considerations">Key Considerations</a></h2>
<p>When deciding between using a resource or a record, consider the following:</p>
<ul>
<li>Performance: Records require deep copying when passed between guest and host,
which can be expensive for large or complex records. Consider using resources
for objects with significant amounts of data or complex structures to mitigate
performance issues.</li>
<li>Immutability: Records provide a level of immutability due to their
pass-by-value nature. If immutability is a priority, records can be a suitable
choice. However, if you need to frequently modify an object's state, a resource
might be more appropriate.</li>
<li>Encapsulation: For objects with both data and behavior, consider whether
separating the data and behavior into different objects—a record for data and a
resource for behavior—adds value or complexity to your code.</li>
<li>Data Sharing: If data sharing or synchronization across components or
instances is important, resources are a better choice since they use references,
while records are not ideal for sharing data.</li>
</ul>
<h2 id="edge-cases"><a class="header" href="#edge-cases">Edge Cases</a></h2>
<p>While the <em>&quot;Records contain data, resources encapsulate behaviour&quot;</em> rule works
for most cases, you will almost certainly run into situations where something
has both data and behaviour.</p>
<p>This happens a lot when wrapping a &quot;normal&quot; library with a WAI interface so it
can be used from WebAssembly. The distinction between &quot;object&quot; and &quot;data&quot; is
more fluid in most general purpose programming languages, so it can be common to
encounter something that doesn't neatly fall into the &quot;record&quot; or &quot;resource&quot;
categories.</p>
<h3 id="workaround-1-getters--setters"><a class="header" href="#workaround-1-getters--setters">Workaround 1: Getters &amp; Setters</a></h3>
<p>If something would normally have publicly accessible fields <strong>and</strong> methods
which might modify those fields, the best solution is to make that thing a
resource with getters and setters.</p>
<p>For example, a virtual machine might normally expose its instruction pointer
and any global variables that are defined, while also having an <code>eval()</code> method
for evaluating code snippets.</p>
<pre><code>resource virtual-machine {
    instruction-pointer: func() -&gt; u32
    set-instruction-pointer: func(ip: u32)
    global-variables: func() -&gt; list&lt;tuple&lt;string, value&gt;&gt;
    set-global-variable: func(name: string, value: value)
    eval: func(code: string) -&gt; expected&lt;unit, error&gt;
}
</code></pre>
<p>This approach works particularly well when the methods will update state because
all resources are reference types, meaning any modifications made to a resource
through one handle (e.g. via a method) will be seen by all other handles to the
same resource.</p>
<p>One downside of this approach is that each getter or setter is implemented using
a method. When you have a large number of fields to expose, these extra methods
can become hard to maintain or make it easy to lose interesting functionality
within a wall of boilerplate.</p>
<h3 id="workaround-2-move-methods-to-top-level-functions"><a class="header" href="#workaround-2-move-methods-to-top-level-functions">Workaround 2: Move Methods to Top-Level Functions</a></h3>
<p>Going in the other direction, sometimes it might be better to turn methods into
top-level functions and use a record.</p>
<p>One example of this could be the satellite object used in a library that
predicts the motion of a satellite.</p>
<pre><code class="language-wai">/// An element
record satellite {
    object-name: optional&lt;string&gt;,
    norad-id: u64,
    inclination: float64,
    right-ascension: float64,
    ..
}

/// Parse a satellite from its JSON representation.
satellite-from-json: func(json: string) -&gt; expected&lt;satellite, error&gt;

/// Predict where a satellite will be at a particular time.
predicted-location: func(s: satellite, ts: timestamp) -&gt; position
</code></pre>
<p>This works well when the thing being expressed is mostly data, with only a
couple of pieces of associated behaviour.</p>
<p>Records are passed around by value, meaning any operations that would normally
modify a field will need to return a new value with the updated field, instead.
This can be quite expensive when the record is large, because passing a record
from guest to host (or host to guest) will often mean the entire object is
serialized recursively and copied across the host-guest boundary. Consider the
trade-offs between performance and immutability when deciding whether to use
records or resources in these edge cases.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../concepts/wai/resources.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../contributing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../concepts/wai/resources.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../contributing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
